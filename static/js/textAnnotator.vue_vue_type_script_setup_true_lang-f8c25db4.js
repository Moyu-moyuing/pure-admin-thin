import{_ as H}from"./entityLabel.vue_vue_type_script_setup_true_lang-2ef8f457.js";import{d as A,n as d,p as M,t as V,K as S,a5 as X,r as O,o as r,c as s,a as b,j as _,b as c,F as y,v as p,x as G,a9 as U,h as Y,z as E,i as P,O as j}from"./index-ca7ab5f3.js";const q=[{text:"马化腾",entity:{id:"e1",text:"马化腾",type:"人物"}},{text:"是"},{text:"腾讯",entity:{id:"e2",text:"腾讯",type:"公司"}},{text:"的创始人。"},{text:"他与"},{text:"张小龙",entity:{id:"e3",text:"张小龙",type:"人物"}},{text:"合作多年。"},{text:"马化腾",entity:{id:"e4",text:"马化腾",type:"人物"}},{text:"是"},{text:"腾讯",entity:{id:"e5",text:"腾讯",type:"公司"}},{text:"的创始人。"},{text:"他与"},{text:"张小龙",entity:{id:"e6",text:"张小龙",type:"人物"}},{text:"合作多年。"},{text:"马化腾",entity:{id:"e7",text:"马化腾",type:"人物"}},{text:"是"},{text:"腾讯",entity:{id:"e8",text:"腾讯",type:"公司"}},{text:"的创始人。"},{text:"他与"},{text:"张小龙",entity:{id:"e9",text:"张小龙",type:"人物"}},{text:"合作多年。"},{text:"马化腾",entity:{id:"e10",text:"马化腾",type:"人物"}},{text:"是"},{text:"腾讯",entity:{id:"e11",text:"腾讯",type:"公司"}},{text:"的创始人。"},{text:"他与"},{text:"张小龙",entity:{id:"e12",text:"张小龙",type:"人物"}},{text:"合作多年。"}],K=[{sourceEntityId:"e1",targetEntityId:"e2",type:"创始人"},{sourceEntityId:"e1",targetEntityId:"e3",type:"合作"},{sourceEntityId:"e4",targetEntityId:"e5",type:"创始人"},{sourceEntityId:"e6",targetEntityId:"e10",type:"合作"},{sourceEntityId:"e7",targetEntityId:"e8",type:"创始人"},{sourceEntityId:"e9",targetEntityId:"e7",type:"合作"},{sourceEntityId:"e10",targetEntityId:"e11",type:"创始人"},{sourceEntityId:"e12",targetEntityId:"e7",type:"合作"}],J=["人物","公司"],Q={class:"flex items-center justify-center flex-wrap gap-2"},Z={key:1,class:"whitespace-normal mr-[-1px] mx-[1px] my-0 inline-block relative"},tt=c("defs",null,[c("marker",{id:"arrow",markerWidth:"10",markerHeight:"10",refX:"0",refY:"3",orient:"auto",markerUnits:"userSpaceOnUse"},[c("path",{d:"M0,0 L0,6 L9,3 z",fill:"var(--el-color-primary)"})]),c("marker",{id:"hoveredArrow",markerWidth:"15",markerHeight:"15",refX:"3.6",refY:"4.5",orient:"auto",markerUnits:"userSpaceOnUse"},[c("path",{d:"M0,0 L0,9 L13.5,4.5 z",fill:"var(--el-color-primary)"})])],-1),et=["d","stroke-width","marker-end","onMouseover","onMouseout"],ot=["x","y","width","height","onMouseover","onMouseout"],nt=["x","y"],rt=A({name:"TextAnnotator"}),ft=A({...rt,setup(it){const u=d(null),g=d(null),C=d(null),I=d([]),$=d([]),v=d([]),f=d([]),w=d(null),D=()=>{I.value=q,$.value=K,w.value=J},k=a=>{var i;const l=(i=g.value)==null?void 0:i.querySelector(`#entity-${a}`);if(l){const n=l.getBoundingClientRect(),t=u.value.getBoundingClientRect();return{left:n.left-t.left,top:n.top-t.top-8,bottom:n.bottom-t.top+8,width:n.width}}return{left:0,top:0,bottom:0}},W=a=>a.length*10,F=()=>{const a=[],l=[];let i,n;$.value.forEach(t=>{const e=k(t.sourceEntityId),o=k(t.targetEntityId),R=Math.random()*e.width,B=Math.random()*o.width,m=30+-15+Math.random()*(15- -15);if(e.left+=R,o.left+=B,!e||!o)return;let x;Math.abs(e.top-o.top)<10?(x=`M ${e.left} ${e.top} L ${e.left} ${e.top-m} L ${o.left} ${e.top-m} L ${o.left} ${o.top-8}`,i=(e.left+o.left)/2,n=e.top-m):o.top>e.top?(x=`M ${e.left} ${e.bottom} C ${e.left} ${(e.bottom+o.top)/2}, ${o.left} ${(e.bottom+o.top)/2}, ${o.left} ${o.top-8}`,i=(e.left+o.left)/2,n=(e.bottom+o.top)/2):(x=`M ${e.left} ${e.top} C ${e.left} ${(e.top+o.bottom)/2}, ${o.left} ${(e.top+o.bottom)/2}, ${o.left} ${o.bottom+8}`,i=(e.left+o.left)/2,n=(e.top+o.bottom)/2),a.push({id:`${t.sourceEntityId}_${t.type}_${t.targetEntityId}`,path:x,type:t.type,hovered:!1});const T=W(t.type);l.push({id:`${t.sourceEntityId}_${t.type}_${t.targetEntityId}`,x:i-(20+T)/2,y:n-20/2,text:t.type,textX:i,textY:n,textL:T,hovered:!1})}),v.value=a,f.value=l},L=U(()=>{window.innerWidth<=425&&S(()=>{F()})},200),z=M(()=>u.value?u.value.scrollHeight+"px":"100vh"),N=M(()=>u.value?u.value.scrollWidth+"px":"100vh");function h(a,l){const i=v.value.find(t=>t.id===a),n=f.value.find(t=>t.id===a);i&&(i.hovered=l),n&&(n.hovered=l)}return V(()=>{D(),S(()=>{F()}),window.addEventListener("resize",L)}),X(()=>{window.removeEventListener("resize",L)}),(a,l)=>{const i=O("el-button"),n=O("el-card");return r(),s("div",null,[b(n,{shadow:"never"},{header:_(()=>[c("div",Q,[(r(!0),s(y,null,p(w.value,t=>(r(),s("div",{key:t,class:"flex items-center justify-center"},[b(i,{plain:"",type:"primary"},{default:_(()=>[Y(E(t),1)]),_:2},1024)]))),128))])]),default:_(()=>[c("div",{class:"relative w-full h-96 text-xl whitespace-pre break-words m-2.5 overflow-x-auto overflow-y-auto",ref_key:"annotatorContainer",ref:u},[c("div",{ref_key:"annotator",ref:g,class:"relative z-[0] w-[1800px] h-full p-10 leading-[5]"},[(r(!0),s(y,null,p(I.value,(t,e)=>(r(),s(y,{key:e},[t.entity?(r(),P(H,{key:0,entity:t.entity},null,8,["entity"])):(r(),s("span",Z,E(t.text),1))],64))),128))],512),(r(),s("svg",{ref_key:"svgLayer",ref:C,class:"absolute top-0 left-0 pointer-events-none z-[1]",style:G({height:z.value,width:N.value})},[tt,(r(!0),s(y,null,p(v.value,t=>(r(),s("path",{class:"cursor-pointer",key:t.id,d:t.path,fill:"none",stroke:"var(--el-color-primary)","stroke-width":t.hovered?"4":"2","marker-end":t.hovered?"url(#hoveredArrow)":"url(#arrow)","pointer-events":"auto",onMouseover:e=>h(t.id,!0),onMouseout:e=>h(t.id,!1)},null,40,et))),128)),(r(!0),s(y,null,p(f.value,t=>(r(),s("rect",{class:"cursor-pointer",key:t,x:t.hovered?t.x-(20+t.textL)*.1:t.x,y:t.hovered?t.y-20*.1:t.y,width:t.hovered?(20+t.textL)*1.2:20+t.textL,height:t.hovered?20*1.2:20,rx:"5",ry:"5",fill:"var(--el-color-primary)","pointer-events":"auto",onMouseover:e=>h(t.id,!0),onMouseout:e=>h(t.id,!1)},null,40,ot))),128)),(r(!0),s(y,null,p(f.value,t=>(r(),s("text",{key:t,x:t.textX,y:t.textY,"text-anchor":"middle","dominant-baseline":"central",class:j(t.hovered?"text-base font-bold z-[100]":"text-sm font-bold z-[100]"),fill:"var(--el-bg-color)"},E(t.text),11,nt))),128))],4))],512)]),_:1})])}}});export{ft as _};
